(1) 동시에 같은 DB Table row 를 업데이트 하는 상황을 방어하기 위해 어떻게 개발하실 건지 설명해주세요.
- 해당 테이블 데이터에 대한 수정 요청이 많은 경우와 그렇지 않은 경우를 나눠서 생각해볼 수 있을것 같습니다.
- 수정 요청이 많을 경우, 명확한 직렬화를 통해 동일한 데이터가 동시에 수정되지 않도록 해야할 필요가 있습니다.
- 이를 논리적으로 명확히하기 위해선, 해당 데이터를 사용(수정하거나 조회를 모두 포함해서)하기 전에 해당 데이터에 대한 명시적인 Lock을 걸고, Lock이 걸려있을 경우엔 사용을 막도록 개발할 수 있습니다.
- 이와 같이 같은 데이터의 동시 수정이 일어날수 있음을 가정하고, 작업 수행간에 다른 작업의 수행을 막는 방식을 비관적 락이라고 합니다.
- 작업 단위(트랜잭션) 사이에 명확한 직렬화가 가능하지만, 선행 트랜잭션이 길어지면 후속 트랜잭션들의 수행이 해당 시간동안 대기해야 하기때문에, 메모리와 cpu의 비효율이 발생할 수 있습니다
- 수정 요청이 적을 경우, 동일한 데이터가 동시에 수정되지 않을 거라고 가정하고 개발할 수 있습니다.
- 데이터 수정 직전에 동일한 조건으로 데이터를 한번더 조회해, 이전 결과와 동일한 경우에만 수정 작업을 수행합니다
- 만약 이전 결과와 동일하지 않다면, 해당 트랜잭션을 비정상 종료시키거나, 별도의 추가 로직으로 데이터를 보정해준뒤 후속 작업을 수행합니다.
- 이와 같은 방식을 낙관적 락이라고 합니다.
- 데이터의 수정여부를 체크하는 방식은 버전이나 타임스탬프 등의 칼럼을 추가해 확인할 수도 있습니다. 핵심은 수정시점에 데이터의 수정이 없음을 보장하기 위한 로직이 추가된다는 점입니다.
